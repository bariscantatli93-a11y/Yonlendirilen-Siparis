<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Düzce Lojistik Pro Panel</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background: #f1f5f9; }
        #map { height: 300px; width: 100%; border-radius: 12px; }
        .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 10px; font-weight: 700; text-transform: uppercase; }
        .hazir { background: #fef3c7; color: #92400e; }
        .yolda { background: #dbeafe; color: #1e40af; }
        .teslim { background: #dcfce7; color: #166534; }
        .btn-disabled { opacity: 0.4; pointer-events: none; filter: grayscale(1); }
    </style>
</head>
<body class="pb-10">

    <div class="bg-blue-900 text-white p-4 shadow-lg sticky top-0 z-[1000]">
        <div class="max-w-7xl mx-auto flex flex-wrap justify-between items-center gap-4">
            <div>
                <h1 class="text-xl font-black tracking-tighter">DÜZCE LOJİSTİK</h1>
                <p class="text-[10px] text-blue-300 font-bold uppercase">Operasyon Yönetim Paneli</p>
            </div>
            <div class="flex gap-4 text-center">
                <div class="bg-blue-800 px-3 py-1 rounded border border-blue-700">
                    <p class="text-[9px] text-blue-300 uppercase font-bold">Toplam Ciro</p>
                    <p id="total-ciro" class="text-lg font-black text-white">0 TL</p>
                </div>
                <div class="hidden sm:block border-l border-blue-700 pl-4">
                    <p class="text-[9px] text-blue-300 uppercase font-bold">Nakit / Kart / Online</p>
                    <p id="detay-ciro" class="text-sm font-bold text-emerald-400">0 / 0 / 0</p>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto p-4 grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <div class="lg:col-span-1 space-y-6">
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
                <h2 class="font-black text-slate-800 mb-4 flex items-center gap-2">
                    <span class="w-2 h-5 bg-blue-600 rounded-full"></span> YENİ SİPARİŞ GİRİŞİ
                </h2>
                <div class="space-y-3">
                    <input id="f-musteri" type="text" placeholder="Müşteri Adı" class="w-full p-2 bg-slate-50 border rounded-lg text-sm">
                    <input id="f-adres" type="text" placeholder="Teslimat Adresi" class="w-full p-2 bg-slate-50 border rounded-lg text-sm">
                    <div class="grid grid-cols-2 gap-2">
                        <input id="f-tutar" type="number" placeholder="Tutar (TL)" class="p-2 bg-slate-50 border rounded-lg text-sm">
                        <select id="f-odeme" class="p-2 bg-slate-50 border rounded-lg text-sm">
                            <option value="Nakit">Nakit</option>
                            <option value="Kredi Kartı">Kredi Kartı</option>
                            <option value="Online">Online</option>
                        </select>
                    </div>
                    <select id="f-kurye" class="w-full p-2 bg-slate-50 border rounded-lg text-sm">
                        <option value="Kurye 1">Kurye 1</option>
                        <option value="Kurye 2">Kurye 2</option>
                        <option value="Kurye 3">Kurye 3</option>
                    </select>
                    <button onclick="yeniSiparisEkle()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-2 rounded-lg shadow-lg transition-all active:scale-95">SİSTEME İŞLE</button>
                </div>
            </div>
            
            <div class="bg-white p-2 rounded-2xl shadow-sm border border-slate-200">
                <div id="map"></div>
            </div>
        </div>

        <div class="lg:col-span-1 space-y-4">
            <h2 class="font-black text-slate-800 flex justify-between items-center">
                <span>AKTİF SİPARİŞLER</span>
                <span id="aktif-sayi" class="bg-blue-100 text-blue-600 px-2 py-1 rounded text-xs">0</span>
            </h2>
            <div id="kartlar" class="space-y-3 h-[600px] overflow-y-auto pr-2">
                </div>
        </div>

        <div class="lg:col-span-1 space-y-6">
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
                <h2 class="font-black text-slate-800 mb-4 flex items-center gap-2">
                    <span class="w-2 h-5 bg-emerald-500 rounded-full"></span> KURYE RAPORLARI
                </h2>
                <div id="kurye-rapor" class="space-y-4 text-sm">
                    </div>
            </div>
        </div>

    </div>

    <script>
        const SABIT_NUMARA = "905307938100";
        let siparisler = [
            { id: 1001, adres: "Atatürk Cd. No:45", lat: 40.8385, lng: 31.1620, tutar: 285, musteri: "Ahmet", kurye: "Kurye 1", durum: "Hazırlanıyor", odeme: "Nakit" },
            { id: 1002, adres: "İnönü Sk. 12", lat: 40.8420, lng: 31.1555, tutar: 420, musteri: "Ayşe", kurye: "Kurye 2", durum: "Yolda", odeme: "Kredi Kartı" }
        ];

        let map = L.map('map').setView([40.839, 31.158], 13);
        L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);
        let markers = L.layerGroup().addTo(map);

        function yeniSiparisEkle() {
            const m = document.getElementById('f-musteri').value;
            const a = document.getElementById('f-adres').value;
            const t = parseInt(document.getElementById('f-tutar').value);
            const o = document.getElementById('f-odeme').value;
            const k = document.getElementById('f-kurye').value;

            if(!m || !t) { alert("Lütfen eksik alanları doldurun!"); return; }

            const yeni = {
                id: Math.floor(1000 + Math.random() * 9000),
                musteri: m, adres: a, tutar: t, odeme: o, kurye: k,
                durum: "Hazırlanıyor", lat: 40.839 + (Math.random() - 0.5) * 0.02, lng: 31.158 + (Math.random() - 0.5) * 0.02
            };

            siparisler.unshift(yeni);
            updateUI();
            
            // Formu temizle
            document.getElementById('f-musteri').value = '';
            document.getElementById('f-tutar').value = '';
        }

        function updateUI() {
            const container = document.getElementById('kartlar');
            const rapor = document.getElementById('kurye-rapor');
            container.innerHTML = '';
            rapor.innerHTML = '';
            markers.clearLayers();

            let stats = { total: 0, nakit: 0, kart: 0, online: 0 };
            let kuryeVeri = {};

            siparisler.forEach(s => {
                // Ciro Hesaplama
                stats.total += s.tutar;
                if(s.odeme === "Nakit") stats.nakit += s.tutar;
                else if(s.odeme === "Kredi Kartı") stats.kart += s.tutar;
                else stats.online += s.online;

                // Kurye Hesaplama
                if(!kuryeVeri[s.kurye]) kuryeVeri[s.kurye] = { paket: 0, ciro: 0, nakit: 0, kart: 0 };
                kuryeVeri[s.kurye].paket++;
                kuryeVeri[s.kurye].ciro += s.tutar;
                if(s.odeme === "Nakit") kuryeVeri[s.kurye].nakit += s.tutar;

                // Kart Arayüzü
                const statusClass = s.durum === 'Hazırlanıyor' ? 'hazir' : (s.durum === 'Yolda' ? 'yolda' : 'teslim');
                const isBtnDisabled = s.durum !== 'Hazırlanıyor';
                const mesaj = `*Düzce Lojistik Bildirimi:*\n\n•Sipariş: #${s.id}\nKurye: ${s.kurye}\nTutar: ${s.tutar} TL / Ödeme: ${s.odeme}\n*Adres:* ${s.adres}\nMüşteri Konumu: http://maps.google.com/maps?q=${s.lat},${s.lng}`;

                container.innerHTML += `
                    <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm relative overflow-hidden">
                        <div class="flex justify-between items-start mb-2">
                            <span class="status-badge ${statusClass}">${s.durum}</span>
                            <span class="font-black text-slate-800 text-sm">#${s.id}</span>
                        </div>
                        <p class="text-sm font-bold text-slate-700">${s.musteri}</p>
                        <p class="text-[11px] text-slate-500 mb-2 truncate">${s.adres}</p>
                        <div class="flex justify-between items-center border-t pt-2">
                            <span class="text-blue-600 font-black text-sm">${s.tutar} TL <small class="text-[9px] text-slate-400 font-normal">(${s.odeme})</small></span>
                            <a href="https://wa.me/${SABIT_NUMARA}?text=${encodeURIComponent(mesaj)}" target="_blank"
                               class="bg-emerald-500 text-white px-3 py-1.5 rounded-lg text-[10px] font-black ${isBtnDisabled ? 'btn-disabled' : ''}">BİLDİR</a>
                        </div>
                    </div>
                `;

                // Harita Marker
                let mCol = s.durum === 'Teslim Edildi' ? '#10b981' : (s.durum === 'Yolda' ? '#3b82f6' : '#f59e0b');
                L.circleMarker([s.lat, s.lng], { radius: 6, fillColor: mCol, color: "#fff", weight: 2, fillOpacity: 1 }).addTo(markers);
            });

            // Üst Panel Güncelle
            document.getElementById('total-ciro').innerText = stats.total + ' TL';
            document.getElementById('detay-ciro').innerText = `${stats.nakit} N / ${stats.kart} K / ${stats.online} O`;
            document.getElementById('aktif-sayi').innerText = siparisler.length;

            // Kurye Rapor Güncelle
            Object.keys(kuryeVeri).forEach(k => {
                rapor.innerHTML += `
                    <div class="bg-slate-50 p-3 rounded-lg border border-slate-100">
                        <div class="flex justify-between font-black text-blue-900 border-b pb-1 mb-2">
                            <span>${k}</span>
                            <span class="bg-blue-600 text-white px-2 rounded text-xs">${kuryeVeri[k].paket} Paket</span>
                        </div>
                        <div class="flex justify-between text-[11px] font-bold text-slate-600">
                            <span>Toplam Tahsilat:</span>
                            <span>${kuryeVeri[k].ciro} TL</span>
                        </div>
                        <div class="flex justify-between text-[11px] text-emerald-600">
                            <span>Kuryedeki Nakit:</span>
                            <span>${kuryeVeri[k].nakit} TL</span>
                        </div>
                    </div>
                `;
            });
        }

        updateUI();
    </script>
</body>
</html>
