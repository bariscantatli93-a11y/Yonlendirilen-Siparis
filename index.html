<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Düzce Lojistik Operasyon Merkezi</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #map { height: 40vh; width: 100%; border-radius: 20px; border: 3px solid white; margin-bottom: 16px; }
        .wa-btn { background: #25D366; color: white; padding: 10px 16px; border-radius: 12px; font-weight: bold; font-size: 14px; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; }
        .wa-btn:hover { background: #128C7E; }
        .wa-btn.disabled { background: #9ca3af; opacity: 0.7; pointer-events: none; }
        .login-bg { background: #1e40af; height: 100vh; display: flex; align-items: center; justify-content: center; }
        .order-card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 16px; border-left: 6px solid #1e40af; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .status-badge { padding: 6px 14px; border-radius: 999px; font-size: 13px; font-weight: bold; }
        .status-hazirlanıyor { background: #fef3c7; color: #92400e; }
        .status-yolda { background: #fefce8; color: #854d0e; }
        .status-teslim { background: #dcfce7; color: #166534; }
    </style>
</head>
<body class="bg-slate-100 text-slate-900">

    <div id="login-screen" class="login-bg">
        <div class="w-full max-w-sm p-8 bg-white rounded-3xl shadow-2xl text-center">
            <h1 class="text-3xl font-black text-blue-900 mb-2">DÜZCE LOJİSTİK</h1>
            <p class="text-sm text-slate-500 font-bold uppercase mb-6">Operasyon Merkezi</p>
            <select id="role" class="w-full p-4 border border-slate-300 rounded-xl mb-6 text-center font-bold">
                <option value="">Giriş Türü</option>
                <option value="admin">ADMİN (MERKEZ)</option>
                <option value="Pizza">PİZZA ŞUBESİ</option>
            </select>
            <button id="loginButton" class="w-full bg-blue-600 text-white p-4 rounded-xl font-bold shadow-md active:bg-blue-700">SİSTEME BAĞLAN</button>
        </div>
    </div>

    <div id="main-panel" class="hidden p-4">
        <header class="bg-white p-4 shadow flex justify-between items-center mb-4">
            <h2 id="title" class="text-xl font-black text-blue-900">Panel</h2>
            <button onclick="location.reload()" class="text-red-600 font-bold">ÇIKIŞ</button>
        </header>

        <div id="map" class="mb-6"></div>

        <div class="bg-white p-6 rounded-2xl shadow mb-6 border-l-4 border-blue-600">
            <p class="text-sm font-bold text-slate-500 uppercase">Toplam Hasılat</p>
            <p id="ciro" class="text-4xl font-black text-blue-900">0 TL</p>
        </div>

        <div id="siparisler"></div>
    </div>

    <script>
        const map = L.map('map').setView([40.839, 31.158], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        const siparisler = [
            { id: 1001, adres: "Atatürk Cd. No:45", lat: 40.8385, lng: 31.1620, tutar: 285, musteri: "Ahmet", telefon: "+905551234567", kurye: "K1", durum: "Hazırlanıyor" },
            { id: 1002, adres: "İnönü Sk. 12", lat: 40.8420, lng: 31.1555, tutar: 420, musteri: "Ayşe", telefon: "+905559876543", kurye: "K2", durum: "Yolda" },
            { id: 1003, adres: "Cumhuriyet Blv.", lat: 40.8350, lng: 31.1700, tutar: 180, musteri: "Mehmet", telefon: "+905551112233", kurye: "K3", durum: "Teslim Edildi" },
            { id: 1004, adres: "19 Mayıs Sk.", lat: 40.8450, lng: 31.1480, tutar: 350, musteri: "Fatma", telefon: "+905551234567", kurye: "K1", durum: "Yolda" },
            { id: 1005, adres: "Sahil Yolu 8", lat: 40.8300, lng: 31.1750, tutar: 510, musteri: "Ali", telefon: "+905559876543", kurye: "K2", durum: "Hazırlanıyor" }
        ];

        let markers = [];

        document.getElementById('loginButton').addEventListener('click', () => {
            const role = document.getElementById('role').value;
            if (!role) return alert('Giriş türü seç kral!');

            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-panel').style.display = 'block';
            document.getElementById('title').textContent = role.toUpperCase() + ' PANELİ';

            loadSiparis(role);
        });

        function loadSiparis(role) {
            const container = document.getElementById('siparisler');
            container.innerHTML = '';

            markers.forEach(m => map.removeLayer(m));
            markers = [];

            let list = siparisler;
            let total = 0;

            list.forEach(s => {
                total += s.tutar;

                let colorClass = '';
                if (s.durum === 'Hazırlanıyor') colorClass = 'status-hazirlanıyor';
                else if (s.durum === 'Yolda') colorClass = 'status-yolda';
                else if (s.durum === 'Teslim Edildi') colorClass = 'status-teslim';

                const card = document.createElement('div');
                card.className = 'order-card';
                card.innerHTML = `
                    <div class="flex justify-between mb-2">
                        <p class="font-bold text-lg">Sipariş #${s.id}</p>
                        <span class="status-badge \( {colorClass}"> \){s.durum}</span>
                    </div>
                    <p class="text-sm mb-1"><strong>Adres:</strong> ${s.adres}</p>
                    <p class="text-sm mb-1"><strong>Müşteri:</strong> ${s.musteri}</p>
                    <p class="text-sm mb-3"><strong>Kurye:</strong> ${s.kurye} | ${s.tutar} TL</p>
                    <a href="https://wa.me/\( {s.telefon}?text= \){encodeURIComponent(`Sipariş #${s.id}\nMüşteri: ${s.musteri}\nTutar: ${s.tutar} TL\nAdres: \( {s.adres}\nKonum: https://www.google.com/maps?q= \){s.lat},${s.lng}`)}" 
                       target="_blank" class="wa-btn ${s.durum === 'Teslim Edildi' ? 'disabled' : ''}">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3.93 14.42c-.38.38-1.12.74-1.65.82-.53.08-1.24.12-2.07-.09-.83-.21-1.53-.78-2.12-1.62-.59-.84-.98-1.91-1.08-2.76-.1-.85.09-1.61.57-2.14.48-.53 1.17-.82 1.92-.82h.24c.29 0 .57.06.83.18.26.12.49.3.68.52l.32.43c.19.25.27.56.21.87-.06.31-.25.58-.54.75l-.69.41c-.07.04-.1.13-.07.2l.29.78c.03.08.12.13.21.1l.78-.29c.07-.03.15 0 .2.07l.43.32c.22.17.4.4.52.66.12.26.18.54.18.83v.24c0 .75-.29 1.44-.82 1.92z"/></svg>
                        ${s.durum === 'Teslim Edildi' ? 'Gönderildi' : 'Gönder'}
                    </a>
                `;
                container.appendChild(card);

                const color = s.durum === 'Teslim Edildi' ? '#22c55e' : '#3b82f6';
                const marker = L.marker([s.lat, s.lng], {
                    icon: L.divIcon({
                        html: `<div style="background:${color};width:24px;height:24px;border-radius:50%;border:3px solid white;"></div>`,
                        className: '',
                        iconSize: [24, 24],
                        iconAnchor: [12, 12]
                    })
                }).addTo(map).bindPopup(`#${s.id} - \( {s.adres}<br> \){s.musteri} - \( {s.tutar} TL<br> \){s.kurye} - ${s.durum}`);
                markers.push(marker);
            });

            document.getElementById('ciro').textContent = total + ' TL';

            if (markers.length) map.fitBounds(L.featureGroup(markers).getBounds(), {padding: [50, 50]});
        }
    </script>
</body>
</html>
